% !TEX root = ../00CFVZ_TOCL.tex

\fznote{Missing defs: type, restriction of a valuation}

\subsubsection{One-step languages}

\begin{definition}
Given a finite set $A$, a \emph{one-step model} is a tuple $(D, \val) = (D,\val)$
consisting of a \emph{domain} set $D$ and a valuation $\val: A \to \wp D$.

Depending on context, elements of $A$ will be called \emph{monadic predicates}, \emph{names}
or \emph{propositional variables}.

A \emph{one-step language} is a set $\llang(A)$ of objects called \emph{one-step formulas} over $A$. We assume that one-step languages come with a \emph{truth} relation between one-step formulas and models, written $(D, \val) \models \varphi$.
%We require that $\llang(\bigcap_{i} A_{i}) = \bigcap_{i} \llang(A_{i})$, so that for each $\varphi \in \llang(A)$ there is a smallest $A_{\varphi} \subseteq A$ such that $\varphi \in \llang(A_{\varphi})$; this $A_{\varphi}$ is the set of names that \emph{occur} in $\varphi$.
\end{definition}

The following semantic properties will be useful when studying parity automata.

\begin{definition}\label{def:functionalsentenceofoe} Given a one-step language $\llang(A)$ and $\varphi \in \llang(A)$,
\begin{itemize}
\item $\varphi$ is \emph{monotone} in $B \subseteq A$ if for every one step model $(D,\val)$ and $V' \: A \to \wp(D)$ such that $V(b) \subseteq V'(b)$ for all $b \in B$, $(D,\val) \models \varphi$ implies $(D,\val') \models \varphi$.
\item $\varphi$ is \emph{functional} in $B\subseteq A$ if it is monotone in $B \subseteq A$ and, whenever $(D,\val) \models \varphi$, then there exists a restriction $\val' \: A \to \wp(D)$ of $\val$ such that $(D,\val') \models \varphi$ and $s \in \val'(b)$ for some $b \in B$ implies $s \not\in \val'(a)$ for all $a \in A\setminus\{b\}$.
\item $\varphi$ is \emph{continuous} in $B \subseteq A$ if $\varphi$ is monotone in $B$ and, whenever $(D,\val) \models \varphi$, then there exists a restriction $V' \: A \to \wp(D)$ of $V$ such that $(D,\val') \models \varphi$ and $V'(b)$ is finite for all $b \in B$.
\item $\varphi$ is \emph{functionally continuous} in $B \subseteq A$ if, whenever $(D,\val) \models \varphi$, then there exists a restriction $\val' \: A \to \wp(D)$ of $\val$ witnessing both functionality and continuity in $B$.
\end{itemize}
\end{definition}

\subsubsection{First-order logics}

Our chief examples of one-step languages will be variants of first-order logic with monadic predicates.

\begin{definition}
The one-step language of \emph{first-order logic with equality} ($\ofoe(A)$) on a set of predicates $A$, and individual variables $\fovar$ is given by the sentences (variable-free formulas) generated by the following grammar:\[
\varphi ::= a(x) \mid x \foeq y \mid \exists x.\varphi \mid \forall x.\varphi \mid \lnot\varphi \mid \varphi \lor \varphi \mid \varphi \land \varphi
\]
where $a \in A$ and $x,y\in\fovar$. We use $\ofo$ to denote \emph{first-order logic without equality}, which is defined as $\ofoe$ but without the $\foeq$ predicate.
\end{definition}
%As usual $\forall x.\varphi$ and $\varphi \land \psi$ are defined as $\lnot \exists x.\lnot \varphi$ and $\lnot (\lnot \varphi \lor \lnot \psi)$ respectively.
%The free variables $\FV(\varphi)$ of a formula $\varphi\in\ofoe$ are the \emph{individual} variables which are not bound by a quantifier. The inductive definition of $\FV(\varphi)$ is standard.

Formulas of $\ofoe$ will be interpreted over one-step models $(D,\val \: A \to \wp(D))$ with a variable assignment $\ass: \fovar \to D$. The semantics of $\ofoe$ (and also $\ofo$) is standard:
%

\begin{align*}
(D, \val),\ass \models a(x) & \quad\text{ iff }\quad  x \in \val(a) \\
(D, \val),\ass \models \mid x \foeq y & \quad\text{ iff }\quad \ass(x) = \ass(y) \\
(D, \val),\ass \models \lnot\varphi & \quad\text{ iff }\quad  (D, \val),\ass \not\models \varphi \\
(D, \val),\ass \models \varphi\lor\psi & \quad\text{ iff }\quad  (D, \val),\ass \models \varphi \text{ or } \npmodel,\ass \models \psi \\
(D, \val),\ass \models \varphi\land\psi & \quad\text{ iff }\quad  (D, \val),\ass \models \varphi \text{ and } \npmodel,\ass \models \psi \\
(D, \val),\ass \models \exists x.\varphi & \quad\text{ iff }\quad  \text{there is $s \in D$ such that $(D, \val), \ass[x\mapsto s] \models \varphi$}\\
(D, \val),\ass \models \forall x.\varphi & \quad\text{ iff }\quad  \text{for all $s \in D$, } (D, \val), \ass[x\mapsto s] \models \varphi.
\end{align*}

As wished, this definition induces a truth relation $(D, \val) \models \varphi$ between one-step models and one-step formulas, as the one-step formulas of $\ofoe(A)$ are defined to be the \emph{sentences}, thus there is no need of an explicit free variables assignment $\ass$ in determining their semantics.

We now introduce an extension of first-order logic with two additional quantifiers, which first appeared in the context of Mostowski's study~\cite{Mostowski1957} of generalised quantifiers. The first, written $\qu x. \varphi$, expresses that there exist infinitely many elements satisfying a formula $\varphi$. Its dual, written $\dqu x. \varphi$, expresses that there are \emph{at most finitely many} elements \emph{falsifying} the formula $\varphi$. The formal definition goes as follows, where $\mathcal Q$ ranges over $\{\qu, \dqu\}$.
\begin{equation}\label{eq:definfquant}
\begin{aligned}
\qu := \{(J,X) \mid |X| \geq \aleph_0\} \qquad \qquad \dqu =\{(J,X) \mid |J\setminus X| < \aleph_0\} \\
(D,V),\ass \models {\mathcal Q}x. \phi(x) \quad\text{iff}\quad (D , \{s\in D \mid (D, \val),\ass[x\mapsto s] \models \phi(x) \}) \in {\mathcal Q}
\end{aligned}
\end{equation}

\begin{definition}
The one-step language $\ofoei(A)$ is defined by adding to the grammar of $\ofoe(A)$ the cases $\qu x. \varphi$ and $\dqu x. \varphi$. The truth relation $(D, \val) \models \varphi$ is defined by extending the one for $\ofoe(A)$ with clauses \eqref{eq:definfquant}.
\end{definition}
%Notice that there is no need to explicitly introduce a clause $\dqu x. \varphi$ in the grammar, as semantically it is just equivalent to $\lnot \qu x. \lnot \varphi$. 

%Observe that every valuation $\val: A \to \wp (D)$ can equivalently be seen as a marking (or coloring) $\val^\natural:D \to \wp(A)$ given by $\val^\natural(d) := \{a \in A \mid d \in \val(a)\}$ and as a relation $Z_\val := \{ (a,d) \mid d\in \val(a)\}$. We will use these perspectives interchangeably.

\subsubsection{Normal Forms}

In the rest of the subsection we recall normal forms for $\ofoe$ and $\ofoei$ providing a syntactic characterisation for the aforementioned semantic properties. We start with $\ofoe$: a sentence in \emph{basic form} gives a complete description of the types that are satisfied in a one-step model.

\index{form, basic!$\ofoe$}
\index{$\posdbnfofoe{\vlist{T}}{\Pi}$}
\begin{definition}%[Basic form for \ofoe]
\begin{enumerate}[(i)]
\item A \emph{type} $T$ is just a subset of $A$. It defines a $\ofo$-formula $\tau^{+}_T(x) \df \bigwedge_{a \in T} a(x)$. Given a one-step model $(D,V)$, $s \in D$ \emph{witnesses} a type $T$ if $(D,V), \ass[x\mapsto s] \models \tau^{+}_T(x)$ for any~$\ass$.
\item We say that $\varphi \in \ofoe(A)$ is in \emph{basic form} if $\varphi = \bigvee \posdbnfofoe{\vlist{T}}{\Pi}$ where each disjunct is of the form
%
\begin{equation*}%\label{eq:normalformofoe}
\posdbnfofoe{\vlist{T}}{\Pi} = \exists \vlist{x}.\big(\arediff{\vlist{x}} \land \bigwedge_i \tau^{+}_{T_i}(x_i) \land \forall z.(\arediff{\vlist{x},z} \lthen \bigvee_{S\in \Pi} \tau^{+}_S(z))\big)
\end{equation*}
%
such that $\vlist{T} \in \wp(A)^k$ for some $k$ and $\Pi \subseteq \vlist{T}$.  The predicate $\arediff{\vlist{y}}$, stating that the elements $\vlist{y}$ are distinct, is defined as $\arediff{y_1,\dots,y_n} := \bigwedge_{1\leq m < m^{\prime} \leq n} (y_m \not\approx y_{m^{\prime}})$.
\end{enumerate}
\end{definition}

Intuitively, the formula $\posdbnfofoe{\vlist{T}}{\Pi}$ says that each one-step model satisfying it admits a partition of its domain in two parts: distinct elements $t_1,\dots,t_n$ witnessing types $T_1,\dots,T_n$, and all the remaining elements witnessing some type $S$ of $\Pi$. The following result characterises the monotone and the monotone functional fragments of $\ofoe(A)$.

\begin{theorem}\label{cor:ofoeicontinuousnf} For a sentence $\varphi \in \ofoe(A)$, the following are equivalent.
\begin{enumerate}[(i)]
\item $\varphi$ is monotone in $A$.
\item $\varphi$ is equivalent to a sentence given in the fragment $\monot{\ofo}{}(A)$ defined as follows, with $a$ ranging over $A$.
\[
\varphi ::= a(x) \mid \exists x.\varphi \mid \forall x.\varphi \mid \varphi \land \varphi \mid \varphi \lor \varphi.
\]
\item There is a translation $(\cdot)^{\bullet}$ turning $\varphi$ into an equivalent sentence in basic form $\varphi^{\bullet} = \bigvee \posdbnfofoe{\vlist{T}}{\Pi}$.
\end{enumerate}
Furthermore, for $B \subseteq A$, if each $T_1, \dots, T_k$ and each $S \in \Pi$ in $\varphi^{\bullet}$ are either $\emptyset$ of singletons $\{b\}$ for some $b \in B$, then $\varphi$ is functional in $B$.
\end{theorem}


%%%%

We now move to $\ofoei(A)$. Its capacity to tear apart finite and infinite sets of elements is reflected in the extra constraints of the basic form, compared to the one of $\ofoe(A)$.

\index{$\mondbnfofoei{\vlist{T}}{\Pi}{\Sigma}{A'}$}
\index{$\mondbnfinf{\Sigma}{A'}$}
\index{$\posdbnfofoei{\vlist{T}}{\Pi}{\Sigma}$}
\begin{definition}
We say that $\varphi \in \ofoei(A)$ is in \emph{basic form} if $\varphi = \bigvee \posdbnfofoei{\vlist{T}}{\Pi}{\Sigma}$ where each disjunct is of the form
\begin{align*}
	\posdbnfofoei{\vlist{T}}{\Pi}{\Sigma} &:= \posdbnfofoe{\vlist{T}}{\Pi \cup \Sigma} \land \posdbnfinf{\Sigma}\\
	%
	%\posdbnfofoe{\vlist{T}}{\Lambda} &:= \exists \vlist{x}.\big(\arediff{\vlist{x}} \land \bigwedge_i \tau^{+}_{T_i}(x_i) \land \forall z.(\arediff{\vlist{x},z} \lthen \bigvee_{S\in \Lambda} \tau^{+}_S(z))\big) \\
	%
	\posdbnfinf{\Sigma} &:= \bigwedge_{S\in\Sigma} \qu y.\tau^{+}_S(y) \land \dqu y.\bigvee_{S\in\Sigma} \tau^{+}_S(y) .
\end{align*}
for some set of types $\Pi,\Sigma \subseteq \wp A$ and $T_1, \dots, T_k \subseteq A$.
\end{definition}

Intuitively, the formula $\posdbnfinf{\Sigma}$ extends the information given by $\posdbnfofoe{\vlist{T}}{\Pi \cup \Sigma}$ by saying that (1) for every type $S\in\Sigma$, there are infinitely many elements satisfying $S$ and (2) only finitely many elements do not satisfy any type in $\Sigma$. In short, any one-step model satisfying $\posdbnfofoei{\vlist{T}}{\Pi}{\Sigma}$ admits a partition of its domain in three parts: (1) distinct elements $t_1,\dots,t_n$ witnessing types $T_1,\dots,T_n$ respectively; (2) finitely many elements whose types belong to $\Pi$, and (3) for each $S\in \Sigma$, infinitely many elements witnessing type $S$.

\begin{theorem}\label{cor:ofoeicontinuousnf} For a sentence $\varphi \in \ofoe(A)$, the following are equivalent.
\begin{enumerate}[(i)]
\item $\varphi$ is continuous in $B \subseteq A$.
\item $\varphi$ is equivalent to a sentence given in the fragment $\cont{\ofoei}{B}(A)$ defined as follows, with $a$ ranging over $B$.
\[
\varphi ::= \psi \mid a(x) \mid \exists x.\varphi \mid \varphi \land \varphi \mid \varphi \lor \varphi \mid \wqu x.(\varphi,\psi)
\]
where $a\in B$, $\psi \in \ofoei(A\setminus B)$ and $\wqu x.(\varphi,\psi) \df \forall x.(\varphi(x) \lor \psi(x)) \land \dqu x.\psi(x)$.
\item There is a translation $(\cdot)^{\bullet}$ turning $\varphi$ into an equivalent sentence in basic form $\varphi^{\bullet} = \bigvee \mondbnfofoei{\vlist{T}}{\Psi \cup \Sigma}{\Sigma}{+}$ such that, for all $b \in B$, $b\notin \bigcup\Sigma$.
\end{enumerate}
Furthermore if each $T_1, \dots, T_k$ and each $S \in \Pi$ in $\varphi^{\bullet}$ are either $\emptyset$ of singletons $\{b\}$ for some $b \in B$, then $\varphi$ is functionally continuous in $B$.
\end{theorem}

%\begin{theorem}\label{cor:ofoeicontinuousnf} ~%For a sentence $\varphi \in \ofoe(A)$, the following are equivalent.
%\begin{enumerate}[(i)]
%\item There is a translation $(\cdot)^{\bullet}$ of any sentence $\varphi \in \ofoei(A)$ into an equivalent sentence in basic form $\varphi^{\bullet} = \bigvee \mondbnfofoei{\vlist{T}}{\Psi \cup \Sigma}{\Sigma}{+}$.
%\item $\varphi$ is continuous in $B \subseteq A$ if and only if $b\notin \bigcup\Sigma$ for all $b \in B$ occurring in $\varphi^{\bullet}$.
%\item $\varphi$ is continuous in $B \subseteq A$ if and only if it is equivalent to a sentence given in the fragment $\cont{\ofoei}{B}(A)$ defined as follows
%\[
%\varphi ::= \psi \mid a(x) \mid \exists x.\varphi \mid \varphi \land \varphi \mid \varphi \lor \varphi \mid \wqu x.(\varphi,\psi)
%\]
%where $a\in B$, $\psi \in \ofoei(A\setminus B)$ and $\wqu x.(\varphi,\psi) \df \forall x.(\varphi(x) \lor \psi(x)) \land \dqu x.\psi(x)$.
%\item $\varphi$ is functionally continuous in $B \subseteq A$ if and only if each $T_1, \dots, T_k$ and each $S \in \Pi$ in $\varphi^{\bullet}$ are either $\emptyset$ of singletons $\{b\}$ for some $b \in B$.
%\end{enumerate}
%\end{theorem}



\begin{remark} Both for $\ofoe$ and $\ofoei$, a translation $(\cdot)^{\bullet}$ exists for all sentences, not just the monotone ones. Intuitively, the outcome of the translation is a normal form $\varphi^{\bullet}$ giving also a description of the complement of each type: type-subformulas are of the form $\tau_T(x) \df \bigwedge_{a \in T} a(x) \wedge \bigwedge_{b \not\in T} \lnot b(x)$ rather than $\tau^{+}_T(x) = \bigwedge_{a \in T} a(x)$. As the study of parity automata only uses the monotone fragment of $\ofoe$ and $\ofoei$, for simplicity we omit further details and refer the interested reader to \cite{???}.\end{remark}

