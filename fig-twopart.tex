

\begin{figure}[h]
\centering
\begin{tikzpicture}[node distance=1.3cm,>=stealth',bend angle=45,auto]
  \tikzstyle{node}=[circle,fill=black,minimum size=5pt,inner sep=1pt]
  \tikzstyle{place}=[circle,thick,draw=blue!75,fill=blue!20,minimum size=6mm]
  \tikzstyle{iplace}=[place,draw=red!75,fill=red!20]
  \tikzstyle{inter}=[dashed,draw=black!50,->]

  \begin{scope}
    % First net
    \node [node] (w1)                                    {};
    \node [node] (c1) [below of=w1]                      {};
    \node [node] (s)  [below of=c1] {};
    \node [node] (c2) [below of=s]                       {};
    \node [node] (w2) [below of=c2]                      {};

    \node [node] (e1) [left of=c1] {}
      edge [pre,bend left]                  (w1)
      edge [post,bend right]                (s)
      edge [post]                           (c1);

    \node [node] (e2) [left of=c2] {}
      edge [pre,bend right]                 (w2)
      edge [post,bend left]                 (s)
      edge [post]                           (c2);

    \node [node] (l1) [right of=c1] {}
      edge [pre]                            (c1)
      edge [pre,bend left]                  (s)
      edge [post,bend right] (w1);

    \node [node] (l2) [right of=c2] {}
      edge [pre]                            (c2)
      edge [pre,bend right]                 (s)
      edge [post,bend left]         (w2);
  \end{scope}

  \begin{scope}[xshift=-6cm]
    % Second net
    \node [iplace,tokens=1] (w1')   {}
      edge [inter,bend angle=20, bend left] (e1);

    \node [place,tokens=2] (c1') [below of=w1'] {}
    	edge [inter,bend angle=30, bend right] (l1);

    \node [place,tokens=2] (s1') [below of=c1',xshift=-5mm]      {};
    \node [place,tokens=3]
                      (s2') [below of=c1',xshift=5mm] {};
    \node [place,tokens=4]     (c2') [below of=s1',xshift=5mm]                      {}
    	edge [inter,bend angle=20, bend right] (l2);

    \node [place,tokens=3]
                      (w2') [below of=c2']                                 {};

    \node [place,tokens=3] (e1') [left of=c1'] {}
      edge [pre,bend left]                  (w1')
      edge [post]                           (s1')
      edge [pre]                            (s2')
      edge [post]                           (c1')
      edge [inter,bend angle=20, bend right] (c1);

    \node [place,tokens=3] (e2') [left of=c2'] {}
      edge [pre,bend right]                 (w2')
      edge [post]                           (s1')
      edge [pre]                            (s2')
      edge [post]                           (c2')
      edge [inter,bend angle=20, bend right] (c2);

    \node [place,tokens=3] (l1') [right of=c1'] {}
      edge [pre]                            (c1')
      edge [pre]                            (s1')
      edge [post]                           (s2')
      edge [post,bend right]  (w1');

    \node [place,tokens=3] (l2') [right of=c2'] {}
      edge [pre]                            (c2')
      edge [pre]                            (s1')
      edge [post]                           (s2')
      edge [post,bend left]        (w2')
      edge [inter,bend angle=20, bend right] (w2);
  \end{scope}

  \begin{pgfonlayer}{background}
    \filldraw [line width=4mm,join=round,black!10]
      % (w1.north  -| l1.east)  rectangle (w2.south  -| e1.west)
      (w1'.north  -| l1.east) rectangle (w2'.south  -| e1.west)
      (w1'.north -| l1'.east) rectangle (w2'.south -| e1'.west);
  \end{pgfonlayer}
\end{tikzpicture}
\caption{Two-part construction, initial state in red (illustrative)}
\label{fig:twopart}
\end{figure}
