% !TEX root = ../00CFVZ_TOCL.tex

% \section{Introduction}\label{sec:intro}

\subsection{Expressiveness modulo bisimilarity.}
%
This paper concerns the relative expressive power of some languages used for
describing properties of pointed labelled transitions systems or Kripke
models.
The interest in such expressiveness questions stems from applications where
these structures model computational processes, and bisimilar pointed
structures represent the \emph{same} process.
Seen from this perspective, properties of transition structures are relevant
only if they are invariant under bisimilarity.
This explains the importance of bisimulation invariance results of the form
\begin{equation}
\label{eq:1}
%\eqno{(*)}
M \equiv L / {\bis} \text{ (over $K$)}
\end{equation}
stating that,  if one restricts attention to a certain class $K$ of transition
structures, one language $M$ is expressively complete with respect to the
relevant (i.e., bisimulation-invariant) properties that can be formulated in
another language $L$.
In this setting, generally $L$ is some rich yardstick formalism such as
first-order or monadic second-order logic, and $M$ is some modal-style
fragment of $L$, usually displaying much better computational behavior
than the full language $L$.

A seminal result in the theory of modal logic is van Benthem's Characterisation
Theorem~\cite{vanBenthemPhD}, stating that every bisimulation-invariant
first-order formula $\alpha(x)$ is actually equivalent to (the standard
translation of) a modal formula:
\begin{equation*}
%\label{eq-vB}
\ML \equiv \fo/{\bis} \text{ (over the class of all LTSs)}.
\end{equation*}
Over the years, a wealth of variants of the Characterisation Theorem have been
obtained.
For instance, Rosen proved that van Benthem's theorem is one of the few
preservation results that transfers to the setting of finite
models~\cite{rose:moda97}; for a recent, rich source of van Benthem-style
characterisation results, see~\cite{DawarO09}.

\subsection{Second-order logics and modal $\mu$-calculi}

Our point of departure is the work~\cite{Jan96}, which extends van Benthem's
result to the setting of \emph{second-order} logic, by proving that the 
bisimulation-invariant fragment of (standard) monadic second-order logic 
($\mso$) is the \emph{modal $\mu$-calculus} ($\MC$), viz., the extension of
basic modal logic with least- and greatest fixpoint operators:
\begin{equation}
\label{eq-JW}
\MC \equiv \mso/{\bis} \text{ (over the class of all LTSs)}.
\end{equation}
Our goal here is to study the fine structure of such connections between 
second-order logics and modal $\mu$-calculi.
In particular, we shall prove two natural variations of \eqref{eq-JW}.

First, we identify the bisimulation-invariant fragment of \emph{weak} monadic 
second-order logic ($\wmso$), the variant of standard $\mso$ where second-order
quantification ranges over finite subsets of the domain.
Before moving on, we should stress the role of the ambient class $K$ in
bisimulation-invariance results.
Over the class of finitely branching LTSs, where $\wmso$ is strictly less 
expressive than $\mso$, it seems to be folklore that $\wmso/{\bis}$ corresponds
to $\afmc$, the alternation-free fragment of the modal $\mu$-calculus
(in the setting of binary trees, this result was proved in~\cite{ArnoldN01}).
In the case of structures of arbitrary branching degree, however, $\wmso$ and
$\mso$ have \emph{incomparable} expressive power, see~\cite{CateF11} for the
details.

We shall see that the bisimulation-invariant fragment of $\wmso$ is 
a certain syntactic fragment $\mucML$ of the modal $\mu$-calculus:
% which is weaker than the alternation-free fragment:
\begin{equation}
\label{eq-main}
\mucML \equiv \wmso/{\bis}  \text{ (over the class of all LTSs)}.
\end{equation}
To define this fragment $\mucML$, which is strictly weaker than the 
alternation-free fragment of $\muML$, first consider the following grammar:
\begin{equation}
\label{eq:syntmu}
\phi\ ::= q \mid \neg\phi \mid 
    \phi \lor \phi \mid  \Diamond \phi \mid
    \mu p.\phi' 
\end{equation}
To define the full language of the $\mu$-calculus, the application of the least
fixpoint operator $\mu$ in \eqref{eq:syntmu} is restricted to formulas $\phi'$ 
that are positive in $p$.
% , that is, where all occurrences of $p$
% are in the scope of an even number of negations.
To obtain the fragment $\mucML$, this condition is strengthened to the 
requirement that $\phi$ belongs to the fragment $\cont{\mucML}{p}$ of formulas
that are (syntactically) \emph{continuous} in $p$ --- precise definitions will
be given later on.
The name \emph{continuity} refers to the fact that formulas in the fragment are
interpreted by functions that are continuous with respect to the Scott topology;
we refer to~\cite{Fontaine08,FV12} for further details.

For our second bisimulation invariance result we move in the opposite 
direction.
That is, starting from the alternation-free fragment of the modal 
$\mu$-calculus we look for a natural second-order logic of which $\afmc$ is the 
bisimulation-invariant fragment. 

%This fragment is defined by the adding the requirement that the application of the least fixpoint in  \eqref{eq:syntmu} is restricted to formulas $\phi'$ that are (syntactically) \emph{noetherian} in $p$, that is formulas in which free (unbounded) occurrences of $p$ are not in the scope of a greatest fixpoint operator. 

%Analogously to the case of continuity, a crucial aspect in the aim of identifying the second order counterpart of  $\afmc$ is to understand to which semantical property the term noetherian refers, or stated otherwise to understand the semantical meaning of the noetherian property. 
%Thus, consider an alternation free formula $\mu p. \phi'$, and a tree 


\btbs
\item
represent $\afmc$ as fragment in style of \eqref{eq:syntmu}
\item
introduce noetherian subsets
\etbs

\newpage

\subsection{Automata for $\wmso$ and $\nmso$.}

As usual in this research area, our proof will be automata-theoretic in
nature.
\btbs
\item
More specifically, as the second main contribution of this paper, we
introduce new classes of parity automata that exactly capture the expressive
power of the second-order languages $\wmso$ and $\nmso$ (over tree models), 
and of the modal languages $\mucML$ and $\mudML$ (over arbitrary models).
\etbs

To discuss our approach in a bit more detail, we need a short digression on 
\emph{monadic predicate logics}, or, as we shall call these here, \emph{one-step
logics}.
These are logical languages for describing properties of very simple structures,
so-called one-step models, of the form $(D,V)$ where $D$ is some domain, and 
$V: A \to \wp D$ is a valuation interpreting the elements of a given set $A$ 
of monadic predicate symbols as unary relations over (subsets of) $D$.
Examples of such languages are $\ofoe$ and $\ofo$ (monadic first-order logic
with and without equality, respectively), fragments thereof, but also extensions
with second-order quantification or with generalised quantifiers.
The point is that with each such one-step logic $\llang$ we may naturally 
associate a class $\Aut(\llang)$ of parity automata: 

\btbs
\item
structures of the  $\aut = \tup{A,\tmap,\pmap,a_I}$ where 
$\pmap: A \to \bbN$ is the priority map of $\aut$, $a_{I}$ its initial state,
and $\tmap: A \times \wp(\props) \to \llang(A)$ its transition function.
\item
That is, $\tmap$ maps  XXXX
\item
For some more detail, let us first see what J \& W do
\begin{eqnarray}
\mso & \equiv & \Aut(\ofoe) \equiv \Aut(1\wmso)
 \text{ (over tree models)},
\\ \muML & \equiv & \Aut(\ofo)
 \text{ (over arbitrary models)},
\end{eqnarray}

\item
our automata: restrictions in two dimensions:
  \btbs
  \item
  vertical: \emph{weakness} condition on priority map
  \item
  horizontal: choice of and conditions on transition map
  \\
  one-step logics: simple languages, monadic predicate logics, 
  co-domain of automata
  \etbs
\item
NMSO: weak automata
\item
WMSO: weak-continuous automata
\item
other possibilities?
\etbs

\subsection{Bisimulation invariance, via automata}


\newpage


\subsection{Automata for $\wmso$ and $\nmso$.}
%

Before we turn to a description of these automata, we first have a look at the
automata, introduced by Walukiewicz~\cite{Walukiewicz96}, corresponding to $\mso$
(over tree models).
Fixing the set of proposition letters of our models as $\props$, we think of
$\wp(\props)$ as an \emph{alphabet} or set of \emph{colors}.
We can then define an $\mso$-automaton as a tuple $\aut = 
\tup{A,\tmap,\pmap,a_I}$, where $A$ is a finite set of states, $a_I$ an initial state, and $\pmap:
A \to \bbN$ is a parity function.
%
The transition function $\tmap$ maps a pair $(a,c) \in A \times \pw(\props)$ to a
sentence in the first-order language (with equality) $\ofoe(A)$, of which the
state space $A$ provides the set of (monadic) predicates.
%
For a more precise definition, let $\ofoe^+(A)$ denote the set of
those sentences in $\ofoe(A)$ where all predicates in $A$ occur only positively;
% the formulas of this language can be given by the following syntax:
% \[
% \phi \mathrel{::=}
% a(x)
% %\mid \neg a(y)
% \mid x \foeq y
% \mid \neg (x \foeq y)
% %\mid \neg \phi
% \mid \phi \lor \phi
% \mid \phi \land \phi
% \mid \exists x.\phi
% \mid \forall x.\phi
% \]
% where $a \in A$ and $x,y$ represent individual first-order variables.
we require that $\tmap: A \times \wp(\props) \to \ofoe^+(A)$.

We shall refer to $\ofoe$ as the \emph{one-step language} of $\mso$-automata,
and denote the class of $\mso$-automata with $\Aut(\ofoe)$.
%, because of the key role of $\ofoe(A)$ in
The automata that we consider in this article run on labelled transition systems
and decide wether to accept or reject them. To take such decision we associate
an acceptance game for an
$\mso$-automaton $\bbA$ and a transition system $\model$.
A match of this game consists of two players, $\eloise$ and $\abelard$, moving a
token from one position to another.
When such a match arrives at a so-called \emph{basic} position, i.e., a
position of the form $(a,t) \in A \times T$, the players consider the
sentence $\tmap(a,c_{t}) \in \ofoe^+(A)$, where $c_{t} \in \wp(\props)$ is the color
of $t$ (that is, the set of proposition letters true at $t$).
At this position $\eloise$ has to turn the set $R[t]$ of successors of
$s$ into a \emph{model} for the formula $\tmap(a,c_{t})$ by coming up with an
interpretation $I$ of the monadic predicates $a \in A$ as subsets of $R[s]$,
so that the resulting first-order structure $(R[s],I)$ makes the
formula $\tmap(a,c_{t})$ true.

% \btbs
% \item
% explain role of $\abelard$?
% \etbs

Walukiewicz's key result linking $\mso$ to $\Aut(\ofoe)$ states that
\begin{equation}
\mso \equiv \Aut(\ofoe)
 \text{ (over tree models)},
\end{equation}
and the proof of this result proceeds by inductively showing that every formula
$\phi$ in $\mso$ can be effectively transformed into an equivalent
automaton $\bbA_{\phi} \in \Aut(\ofoe)$.
For the details of this construction, a fairly intricate analysis of the
one-step logic $\ofoe$ is required, crucially involving various normal
forms of the sentences of $\ofoe(A)$.

In order to adapt this approach to the setting of \wmso, observe that by
K\"onig's lemma, a subset of a tree $\model$ is finite iff it is both a subset of
a finitely branching subtree of $\model$ and \emph{noetherian}, that is, a subset
of a subtree of $\model$ that has no infinite branches.
This suggests that we may change the definition of $\mso$-automata into one
of $\wmso$-automata via two kinds of modifications, roughly speaking
corresponding to a horizontal and a vertical `dimension' of trees.

For the `vertical modification' we may turn to the literature on weak automata~\cite{MullerSaoudiSchupp92}.
The acceptance condition $\pmap$ of a parity automaton $\bbA =
\tup{A, \tmap, \pmap, a_I}$ is \emph{weak} if $\pmap(a) = \pmap(a')$ whenever
the states $a$ and $a'$ belong to the same strongly connected component
(SCC) of the automaton. To see that the notion of connected component is well-defined
observe that for $\bbA$ we can associate a directed graph on $A$
such that $a,b \in A$ are connected iff $b$ occurs in $\tmap(a,c)$ for some $c \in \wp(\props)$.
%
Let $\AutW(\ofoe)$ denote the set of $\mso$-automata with a weak parity
condition.
It was proved in \cite{Zanasi:Thesis:2012} (see also \cite{DBLP:conf/lics/FacchiniVZ13}) that
\begin{equation*}
%\label{eq-wfmso}
\nmso \equiv \AutW(\ofoe) \text{ (over the class of all trees)},
\end{equation*}
with $\nmso$ denoting the earlier mentioned variant of $\mso$ %/$\wmso$
where second-order quantification is restricted to noetherian subsets of trees.
From this it easily follows that
\begin{equation*}
%\label{eq-wfmso2}
\wmso \equiv \AutW(\ofoe) \text{ (over the class of finitely
branching trees)},
\end{equation*}
since the noetherian subsets of a finitely branching trees correspond to the
finite ones.
Over the class of all tree models, however, $\wmso$ is \emph{not} equivalent
to $\AutW(\ofoe)$, %$ \equiv \nmso$
as is witnessesed by the earlier mentioned
class of well-founded trees, which can be defined in $\afmc \leq \nmso$,
but not in $\wmso$.

The hurdle to take, in order to find automata for WMSO on trees of
\emph{arbitrary} branching degree, concerns the horizontal dimension; the
main problem lies in finding the right one-step language for
$\wmso$-automata.
An obvious candidate for this language would be weak monadic second-order logic
itself, or more precisely, its variant $\owmso$ over the signature of monadic
predicates (corresponding to the automata states).
A very helpful observation, made by V\"a\"an\"anen~\cite{vaananen77}, states that
\[
\owmso \equiv \ofoei,
\]
where $\ofoei$ is the extension of $\ofoe$ with the generalized quantifier
$\qu$, where $\qu x. \phi$ meaning that there are \emph{infinitely} many
objects satisfying $\phi$.
Taking the \emph{full} language of $\owmso$ or $\ofoei$ as our one-step language
would give too much expressive power: since $\ofoei$ extends $\ofoe$,
we would find that, over tree models, $\AutW(\ofoei)$ extends
$\AutW(\ofoe)$, whereas we already saw that $\AutW(\ofoe) \equiv
\nmso$ is incomparable to $\wmso$.
%
It is here that we will crucially involve the notion of \emph{continuity}.
The automata corresponding to $\wmso$ will be of the form 
$\bbA = \tup{A, \tmap, \pmap, a_I}$,
where the transition map $\tmap: A \times \wp(\props) \to
{\ofoei}^+(A)$ is subject to the following two constraints, for all $a,a' \in A$
belonging to the same strongly connected component of $A$:
\begin{description}
\itemsep 0 pt
\item[(weakness)] $\pmap(a) = \pmap(a')$, and
\item[(continuity)]
if $\pmap(a)$ is odd (resp. even), then for each colour $c\in \wp(\props)$,
   $\tmap(a,c)$ is continuous (resp. co-continuous) in $a'$,
\end{description}
where co-continuity is a dual notion to continuity.
The class of these automata is denoted by $\AutWC(\ofoei)$.
%
Consequently, for a proper definition of these automata we need a
\emph{syntactic} characterization of the $\ofoei(A)$-sentences that are
(co-)continuous in one (or more) monadic predicates of $A$.

For this purpose, we conduct a fairly detailed model-theoretic study of the
logic $\ofoei$ which we consider to be the third main
contribution of our work.
Similar to the results for $\ofoe$, we provide normal forms for the
sentences of $\ofoei(A)$, and syntactic characterizations of the fragments
whose sentences are monotone (respectively continuous) in some monadic predicate $a \in A$.

% \begin{theorem}
% \label{t:m2}
% A sentence of $\ofoei(A)$ is monotone in ${a\in A}$ iff it is equivalent to
% a sentence in the language given by the following syntax:
% \begin{equation}
% \label{eq-pofoei}
% \phi ::= \psi \mid a(x) \mid \exists x.\phi(x) \mid \forall x.\phi(x)
% \mid \phi \land \phi \mid \phi \lor \phi
% \mid \qu x.\phi(x) \mid \dqu x.\phi(x)
% \end{equation}
% where $\psi \in \ofoei(A\setminus \{a\})$.

% A sentence of $\ofoei(A)$ is continuous in ${a\in A}$ iff it is equivalent to
% a sentence in the language given by the following syntax:
% \begin{equation}
% \label{eq-cofoei}
% \phi ::=
% \psi \mid a(x) \mid \exists x.\phi(x) \mid \phi \land \phi
%    \mid \phi \lor \phi \mid \wqu x.(\phi,\psi)
% \end{equation}
% where $\psi \in \ofoei(A\setminus \{a\})$ and
% $\wqu x.(\phi,\psi) :=
%    \forall x.(\phi(x) \lor \psi(x)) \land \dqu x.\psi(x)$.
% \end{theorem}

% Using these characterizations, we can now provide the definition of a
% \wmso-automaton.

% \begin{definition}
% We denote by $\yvmonot{\ofoei}(A)$ the set of sentences that are positive
% in each $a \in A$ (i.e., belong to \eqref{eq-pofoei} for all $a \in A$), and
% we let $\AutW{\ofoei}$ denote the class of structures of the form
% $\bbA = \struc{A, a_I, \tmap, \pmap}$ such that $A$ is a finite set of states,
% $a_I \in A$ is the initial state of $\bbA$, $\tmap: A \times C \to
% \yvmonot{\ofoei}{a}(A)$ is the transition map, and $\pmap: A\to \bbN$ is the
% parity map of $\bbA$.

% Such a structure is a \emph{\wmso-automaton} if $\tmap$ and $\pmap$ satisfy,
% for all states $a,a'$ belonging
% to the same strongly connected component, the following two
% conditions:
% \begin{itemize}
% \item
% (weakness) $\pmap(a) = \pmap(a')$, and
% \item
% (continuity)
% if $\pmap(a')$ is even, then $\tmap(a',c)$
% belongs to the fragment \eqref{eq-cofoei}, for each $c \in \wp(\props)$
% \\ (and a dual condition applies in case $\pmap(a')$ is odd).
% \end{itemize}
% The class of these automata is denoted by $AutWC(\ofoei)$.
% \end{definition}

To finish, we give constructions transforming \wmso-formulas to
\wmso-automata and vice-versa, witnessing that
%
\begin{equation}
\label{eq:m3}
\wmso \equiv \AutWC(\ofoei) \text{ (over tree models)}.
\end{equation}

\subsection{Proof of main result.}

To conclude our introduction we briefly sketch the proof of our main result, 
Theorem~\ref{t:m1}(1).
Roughly speaking, we follow the bisimulation-invariance proof by Janin \& 
Walukiewicz, which revolves around relating two distinct types of automata, 
which correspond, respectively, to the logics $\mso$ and $\MC$.
More precisely, these two automaton types are given as $\AutWC(\ofoe)$ and
$\AutWC(\ofo)$, where the one-step languages are first-order 
logic respectively with and without equality.
What we will add to their proof is the insight from~\cite{Venxx} that the
required relation between $\AutWC(\ofoe)$ and $\AutWC(\ofo)$ already follows
from results relating the respective one-step languages.

In our setting, we need to identify automata corresponding to the fragment
$\mucML$.
For this purpose we introduce the class $\AutWC(\ofo)$ consisting of those
automata in $\AutWC(\ofo)$ that satisfy similar weakness and continuity 
conditions as the ones in $\AutWC(\ofoei)$:
\begin{equation}
\label{eq:autF}
\mucML \equiv \AutWC(\ofo) \text{ (over the class of all LTSs)}.
\end{equation}

As the key step in our proof then, we will provide a translation 
$(-)^{\bullet}: \ofoei \to \ofo$ which naturally induces a transformation 
$(-)^{\bullet}: \AutWC(\ofoei) \to \AutWC(\ofo)$.
As a consequence of the nice model-theoretic properties of the translation at 
the one-step level, the automaton transformation satisfies, for all 
transition systems $\bbT$:
\begin{equation}
\label{eq:crux-i}
\bbA^{\bullet} \text{ accepts } \bbT \text{ iff } \bbA \text{ accepts 
} \omegaunrav{\bbT}
\end{equation}
where $\omegaunrav{\bbT}$ is the $\omega$-unravelling of $\bbT$.
It easily follows from \eqref{eq:crux-i} that a \wmso-automaton $\bbA$
is bisimulation invariant iff $\bbA\equiv \bbA^{\bullet}$, and so 
Theorem~\ref{t:m1}(1) follows by \eqref{eq:m3} and \eqref{eq:autF}.

\subsection{Overview of paper.}
In the next section we give a precise definition of the preliminaries required 
to understand this article. 
In Section~\ref{sec:onestep} we define the one-step logics that will be used 
through the paper and give normal forms and syntactic characterizations of their monotone and (co-)continuous fragments. In Section~\ref{sec:aut} we formally define \wmso-automata and show that from every \wmso-formula we can construct an equivalent \wmso-automaton. In Section~\ref{sec:aut-to-formula_wmso} we prove the converse, that is, for every \wmso-automaton we can construct an equivalent \wmso-formula, this finishes the automata characterization of \wmso over tree models. Finally, in Section~\ref{sec:char} we prove the main result of the paper, namely that the fragment $\mucML$ is the bisimulation-invariant fragment of \wmso.


